æ ¸å¿ƒç»“è®º
ç»è¿‡è¯¦ç»†çš„ä»£ç æ¢ç´¢å’Œæ–¹æ¡ˆè®¾è®¡ï¼Œæˆ‘çš„è¯„ä¼°ç»“æœæ˜¯ï¼š âœ… main.ts å½“å‰ 402 è¡Œä¸ç®—è‡ƒè‚¿ï¼Œä½†å»ºè®®è¿›è¡Œè½»é‡çº§æ‹†åˆ† ä¸»è¦å‘ç°ï¼š
62% çš„ä»£ç æ˜¯é‡å¤æ€§çš„æ³¨å†Œé€»è¾‘ï¼ˆå¯å®‰å…¨æ‹†åˆ†ï¼‰
æ‹†åˆ†å main.ts å°†ç²¾ç®€ 63%ï¼ˆ402 â†’ 150 è¡Œï¼‰
é£é™©ç­‰çº§ï¼šâ­â­ ä½é£é™©ï¼ˆçº¯å£°æ˜å¼ä»£ç ï¼‰
æ”¶ç›Šï¼šæ˜¾è‘—æå‡å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§
æ‹†åˆ†æ–¹æ¡ˆæ¦‚è§ˆ
åˆ›å»º 4 ä¸ªæ–°çš„æ³¨å†Œæ¨¡å—ï¼š
src/srs/registry/commands.ts - å‘½ä»¤æ³¨å†Œï¼ˆ120 è¡Œï¼‰
src/srs/registry/uiComponents.ts - UI ç»„ä»¶æ³¨å†Œï¼ˆ60 è¡Œï¼‰
src/srs/registry/renderers.ts - æ¸²æŸ“å™¨æ³¨å†Œï¼ˆ60 è¡Œï¼‰
src/srs/registry/converters.ts - è½¬æ¢å™¨æ³¨å†Œï¼ˆ70 è¡Œï¼‰
å®Œæ•´çš„å®æ–½æ­¥éª¤ã€éªŒè¯æ¸…å•ã€é£é™©è¯„ä¼°å’Œé¢„æœŸæˆæœå·²å†™å…¥è®¡åˆ’æ–‡ä»¶ã€‚
Claudeâ€™s Plan
src/main.ts æ¨¡å—æ‹†åˆ†è®¡åˆ’
ğŸ“Š è¯„ä¼°ç»“è®º
main.ts å½“å‰çŠ¶æ€ï¼š402 è¡Œï¼ŒèŒè´£æ¸…æ™°
âŒ ä¸ç®—è‡ƒè‚¿ï¼šå¯¹äº Orca æ’ä»¶å…¥å£æ–‡ä»¶æ¥è¯´å¤„äºåˆç†èŒƒå›´ï¼ˆä¸­å‹æ’ä»¶å…¸å‹å€¼ 300-600 è¡Œï¼‰
âœ… å»ºè®®æ‹†åˆ†ï¼šè½»é‡çº§æ‹†åˆ†æ³¨å†Œé€»è¾‘ï¼Œæå‡å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§
â­â­ é£é™©ç­‰çº§ï¼šä½é£é™©ï¼ˆçº¯å£°æ˜å¼ä»£ç ï¼ŒTypeScript ç±»å‹æ£€æŸ¥ä¿éšœï¼‰
ä»£ç èŒè´£åˆ†å¸ƒï¼š
62% æ³¨å†Œé€»è¾‘ï¼ˆå¯æ‹†åˆ†ï¼Œçº¦ 250 è¡Œï¼‰
15% æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆä¿ç•™ï¼Œçº¦ 60 è¡Œï¼‰
23% å¿…è¦ç»“æ„ä»£ç ï¼ˆä¿ç•™ï¼Œçº¦ 92 è¡Œï¼‰
ğŸ¯ æ‹†åˆ†æ–¹æ¡ˆ
ç›®æ ‡æ¶æ„
src/
â”œâ”€â”€ main.ts (ç²¾ç®€è‡³ ~150 è¡Œ)
â”‚   â”œâ”€â”€ load() - è°ƒç”¨å„æ³¨å†Œæ¨¡å—
â”‚   â”œâ”€â”€ unload() - è°ƒç”¨å„æ¸…ç†æ¨¡å—
â”‚   â”œâ”€â”€ startReviewSession() - ä¿ç•™æ ¸å¿ƒé€»è¾‘
â”‚   â””â”€â”€ è¾…åŠ©å¯¼å‡ºå‡½æ•° - ä¿ç•™
â”‚
â””â”€â”€ srs/
    â””â”€â”€ registry/  âœ¨ æ–°å¢ç›®å½•
        â”œâ”€â”€ commands.ts        (~120 è¡Œ) - å‘½ä»¤æ³¨å†Œï¼ˆ3 ä¸ªæ™®é€š + 2 ä¸ªç¼–è¾‘å™¨å‘½ä»¤ï¼‰
        â”œâ”€â”€ uiComponents.ts    (~60 è¡Œ)  - å·¥å…·æ æŒ‰é’®å’Œæ–œæ å‘½ä»¤
        â”œâ”€â”€ renderers.ts       (~60 è¡Œ)  - å—å’Œ inline æ¸²æŸ“å™¨
        â””â”€â”€ converters.ts      (~70 è¡Œ)  - plain æ ¼å¼è½¬æ¢å™¨
æ‹†åˆ†æ”¶ç›Š
âœ… main.ts ç²¾ç®€ 63%ï¼ˆ402 â†’ 150 è¡Œï¼‰
âœ… èŒè´£å•ä¸€ï¼Œæ¯ä¸ªæ¨¡å—æœ‰æ¸…æ™°è¾¹ç•Œ
âœ… ä¾¿äºæ‰©å±•æ–°åŠŸèƒ½ï¼Œé¿å…ä¿®æ”¹å¤§æ–‡ä»¶
âœ… é™ä½è®¤çŸ¥è´Ÿæ‹…ï¼Œæå‡ä»£ç å¯è¯»æ€§
ğŸ“‹ å®æ–½æ­¥éª¤
ç¬¬ 1 æ­¥ï¼šåˆ›å»ºæ³¨å†Œæ¨¡å—ç›®å½•
mkdir -p src/srs/registry
ç¬¬ 2 æ­¥ï¼šæ‹†åˆ†å‘½ä»¤æ³¨å†Œ
æ–°å»ºæ–‡ä»¶ï¼šsrc/srs/registry/commands.tsï¼ˆ~120 è¡Œï¼‰ èŒè´£ï¼š
æ³¨å†Œ 3 ä¸ªæ™®é€šå‘½ä»¤ï¼ˆstartReviewSession, scanCardsFromTags, openCardBrowserï¼‰
æ³¨å†Œ 2 ä¸ªç¼–è¾‘å™¨å‘½ä»¤ï¼ˆmakeCardFromBlock, createClozeï¼Œå« do/undo å‡½æ•°ï¼‰
å¯¼å‡ºæ¥å£ï¼š
export function registerCommands(
  pluginName: string,
  startReviewSession: () => Promise<void>
): void

export function unregisterCommands(pluginName: string): void
ä» main.ts ç§»åŠ¨ï¼š
lines 47-55: startReviewSession å‘½ä»¤
lines 57-65: scanCardsFromTags å‘½ä»¤
lines 67-75: openCardBrowser å‘½ä»¤
lines 80-113: makeCardFromBlock ç¼–è¾‘å™¨å‘½ä»¤
lines 116-168: createCloze ç¼–è¾‘å™¨å‘½ä»¤
ç¬¬ 3 æ­¥ï¼šæ‹†åˆ† UI ç»„ä»¶æ³¨å†Œ
æ–°å»ºæ–‡ä»¶ï¼šsrc/srs/registry/uiComponents.tsï¼ˆ~60 è¡Œï¼‰ èŒè´£ï¼š
æ³¨å†Œ 3 ä¸ªå·¥å…·æ æŒ‰é’®ï¼ˆreviewButton, browserButton, clozeButtonï¼‰
æ³¨å†Œ 1 ä¸ªæ–œæ å‘½ä»¤ï¼ˆmakeCardï¼‰
å¯¼å‡ºæ¥å£ï¼š
export function registerUIComponents(pluginName: string): void
export function unregisterUIComponents(pluginName: string): void
ä» main.ts ç§»åŠ¨ï¼š
lines 174-190: å·¥å…·æ æŒ‰é’®
lines 196-201: æ–œæ å‘½ä»¤
ç¬¬ 4 æ­¥ï¼šæ‹†åˆ†æ¸²æŸ“å™¨æ³¨å†Œ
æ–°å»ºæ–‡ä»¶ï¼šsrc/srs/registry/renderers.tsï¼ˆ~60 è¡Œï¼‰ èŒè´£ï¼š
æ³¨å†Œ 3 ä¸ªå—æ¸²æŸ“å™¨ï¼ˆsrs.card, srs.cloze-card, srs.review-sessionï¼‰
æ³¨å†Œ 1 ä¸ª inline æ¸²æŸ“å™¨ï¼ˆ${pluginName}.clozeï¼‰
å¯¼å‡ºæ¥å£ï¼š
export function registerRenderers(pluginName: string): void
export function unregisterRenderers(pluginName: string): void
ä» main.ts ç§»åŠ¨ï¼š
lines 206-229: å—æ¸²æŸ“å™¨
lines 234-238: inline æ¸²æŸ“å™¨
ç¬¬ 5 æ­¥ï¼šæ‹†åˆ†è½¬æ¢å™¨æ³¨å†Œ
æ–°å»ºæ–‡ä»¶ï¼šsrc/srs/registry/converters.tsï¼ˆ~70 è¡Œï¼‰ èŒè´£ï¼š
æ³¨å†Œ 3 ä¸ªå—è½¬æ¢å™¨ï¼ˆplain â†’ srs.card/cloze-card/review-sessionï¼‰
æ³¨å†Œ 1 ä¸ª inline è½¬æ¢å™¨ï¼ˆplain â†’ ${pluginName}.clozeï¼‰
å¯¼å‡ºæ¥å£ï¼š
export function registerConverters(pluginName: string): void
export function unregisterConverters(pluginName: string): void
ä» main.ts ç§»åŠ¨ï¼š
lines 243-268: å—è½¬æ¢å™¨
lines 271-280: inline è½¬æ¢å™¨
ç¬¬ 6 æ­¥ï¼šé‡æ„ main.ts
ä¿®æ”¹æ–‡ä»¶ï¼šsrc/main.tsï¼ˆç²¾ç®€è‡³ ~150 è¡Œï¼‰ ä¿ç•™å†…å®¹ï¼š
load() å’Œ unload() å‡½æ•°ï¼ˆç®€åŒ–ä¸ºå§”æ‰˜è°ƒç”¨ï¼‰
startReviewSession() å‡½æ•°ï¼ˆæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼‰
getReviewHostPanelId() å’Œ getPluginName() è¾…åŠ©å‡½æ•°
å¯¼å‡ºçš„å…¶ä»–å‡½æ•°
æ–°å¢å¯¼å…¥ï¼š
import { registerCommands, unregisterCommands } from "./srs/registry/commands"
import { registerUIComponents, unregisterUIComponents } from "./srs/registry/uiComponents"
import { registerRenderers, unregisterRenderers } from "./srs/registry/renderers"
import { registerConverters, unregisterConverters } from "./srs/registry/converters"
ç®€åŒ–åçš„ load() å‡½æ•°ï¼š
export async function load(_name: string) {
  pluginName = _name
  setupL10N(orca.state.locale, { "zh-CN": zhCN })

  // å§”æ‰˜ç»™æ³¨å†Œæ¨¡å—
  registerCommands(pluginName, startReviewSession)
  registerUIComponents(pluginName)
  registerRenderers(pluginName)
  registerConverters(pluginName)
}
ç¬¬ 7 æ­¥ï¼šéªŒè¯æ¸…å•
æ¯å®Œæˆä¸€æ­¥ï¼Œç«‹å³éªŒè¯ï¼š
 npm run build æˆåŠŸç¼–è¯‘
 æ—  TypeScript ç±»å‹é”™è¯¯
 æ‰€æœ‰å‘½ä»¤åœ¨å‘½ä»¤é¢æ¿ä¸­å¯è§
 å·¥å…·æ æŒ‰é’®æ­£å¸¸æ˜¾ç¤º
 æ–œæ å‘½ä»¤æ­£å¸¸å·¥ä½œ
 SRS å¡ç‰‡æ¸²æŸ“æ­£å¸¸
 å¤ä¹ ä¼šè¯æ¸²æŸ“æ­£å¸¸
 å¤åˆ¶ä¸ºçº¯æ–‡æœ¬æ­£å¸¸
 æ’¤é”€/é‡åšåŠŸèƒ½æ­£å¸¸
 æ’ä»¶å¯ç”¨/ç¦ç”¨æ­£å¸¸
ç¬¬ 8 æ­¥ï¼šæ›´æ–°æ–‡æ¡£
ä¿®æ”¹æ–‡æ¡£ï¼š
æ›´æ–° æ¨¡å—æ–‡æ¡£/SRS_æ’ä»¶å…¥å£ä¸å‘½ä»¤.md
åˆ›å»º æ¨¡å—æ–‡æ¡£/SRS_æ³¨å†Œæ¨¡å—.mdï¼ˆæ–°å¢ï¼‰
âš ï¸ é£é™©è¯„ä¼°ä¸ç¼“è§£
é£é™©é¡¹	é£é™©ç­‰çº§	ç¼“è§£æªæ–½
æ³¨å†Œé¡ºåºé”™è¯¯	â­ æä½	Orca æ³¨å†Œ API æ— é¡ºåºä¾èµ–
å¯¼å…¥è·¯å¾„é”™è¯¯	â­â­ ä½	TypeScript ç¼–è¯‘æ—¶æ£€æŸ¥
æ³¨å†Œé¡¹é—æ¼	â­â­ ä½	ä½¿ç”¨éªŒè¯æ¸…å•é€é¡¹æ£€æŸ¥
å¢åŠ ç»´æŠ¤æˆæœ¬	â­â­ ä½	æ–‡æ¡£æ¸…æ™°è¯´æ˜æ¨¡å—èŒè´£
å¿«é€Ÿå›æ»šæ–¹æ¡ˆï¼š
# å¦‚æœ‰é—®é¢˜ï¼Œç«‹å³å›æ»š
git reset --hard HEAD~1
ğŸ“ å…³é”®æ–‡ä»¶
éœ€è¦åˆ›å»ºï¼š
src/srs/registry/commands.ts - å‘½ä»¤æ³¨å†Œé€»è¾‘
src/srs/registry/uiComponents.ts - UI ç»„ä»¶æ³¨å†Œé€»è¾‘
src/srs/registry/renderers.ts - æ¸²æŸ“å™¨æ³¨å†Œé€»è¾‘
src/srs/registry/converters.ts - è½¬æ¢å™¨æ³¨å†Œé€»è¾‘
éœ€è¦ä¿®æ”¹ï¼š
src/main.ts - ç²¾ç®€å¹¶å§”æ‰˜ç»™æ³¨å†Œæ¨¡å—
éœ€è¦å‚è€ƒï¼š
src/srs/cardCreator.ts - makeCardFromBlock å®ç°
src/srs/cardBrowser.ts - openCardBrowser å®ç°
src/srs/clozeUtils.ts - createCloze å®ç°
src/components/SrsCardBlockRenderer.tsx - å¡ç‰‡æ¸²æŸ“å™¨
src/components/SrsReviewSessionRenderer.tsx - å¤ä¹ ä¼šè¯æ¸²æŸ“å™¨
src/components/ClozeInlineRenderer.tsx - Cloze inline æ¸²æŸ“å™¨
ğŸ‰ é¢„æœŸæˆæœ
æ‹†åˆ†åçš„æ”¹è¿›ï¼š
main.ts ä» 402 è¡Œç²¾ç®€è‡³ 150 è¡Œï¼ˆ-63%ï¼‰
æ€»ä»£ç é‡ä» 402 è¡Œå¢è‡³ 460 è¡Œï¼ˆ+14%ï¼Œæ¨¡å—åŒ–æ­£å¸¸æˆæœ¬ï¼‰
æ¯ä¸ªæ³¨å†Œæ¨¡å—èŒè´£å•ä¸€ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤
æ–°å¢åŠŸèƒ½æ—¶æ— éœ€ä¿®æ”¹ main.ts å¤§æ–‡ä»¶
å¯¹ç”¨æˆ·å®Œå…¨é€æ˜ï¼Œæ— åŠŸèƒ½å˜åŒ–
